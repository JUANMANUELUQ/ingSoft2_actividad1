<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calificación de Libros</title>
    <link rel="stylesheet" href="css/estiloReview.css">
    <script>
        // Almacenar la calificación seleccionada
        let selectedRating = 0;

        // Manejar el clic en las estrellas de calificación
        document.addEventListener("DOMContentLoaded", () => {
            const stars = document.querySelectorAll('.star');
            stars.forEach(star => {
                star.addEventListener('click', () => {
                    selectedRating = star.getAttribute('data-value');
                    highlightStars(selectedRating);
                });
            });

            // Enviar la calificación y reseña
            document.getElementById('submit-btn').addEventListener('click', enviarReview);
        });

        // Resaltar las estrellas hasta la seleccionada
        function highlightStars(rating) {
            const stars = document.querySelectorAll('.star');
            stars.forEach(star => {
                if (star.getAttribute('data-value') <= rating) {
                    star.style.color = 'gold';
                } else {
                    star.style.color = 'black';
                }
            });
        }

        // Función para enviar la reseña al backend
        function enviarReview() {
            const userName = document.getElementById("user-name").value;
            const bookTitle = document.getElementById("book-title").value;
            const reviewText = document.getElementById("review-text").value;

            if (!userName || !bookTitle || !selectedRating || !reviewText) {
                alert("Por favor, completa todos los campos.");
                return;
            }

            // Crear el objeto de reseña
            const review = {
                userId: userName,
                bookId: bookTitle, // En un caso real, deberías usar el ID real del libro
                rating: parseInt(selectedRating),
                reviewText: reviewText
            };

            // Realizar la solicitud POST al backend
            fetch('http://localhost:8080/api/reviews', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(review)
            })
                .then(response => {
                    if (response.ok) {
                        alert("¡Reseña enviada exitosamente!");
                        // Limpiar los campos del formulario
                        document.getElementById("user-name").value = '';
                        document.getElementById("book-title").value = '';
                        document.getElementById("review-text").value = '';
                        highlightStars(0);
                    } else {
                        alert("Hubo un error al enviar la reseña.");
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert("No se pudo enviar la reseña.");
                });
        }
    </script>
</head>
<body>
<div class="container">
    <h1>Califica y Reseña tu Libro Favorito</h1>

    <!-- Información del libro -->
    <div class="rating-container">
        <!-- Campo de nombre del usuario -->
        <div class="user-info">
            <label for="user-name">Tu nombre:</label>
            <input type="text" id="user-name" placeholder="Introduce tu nombre">
        </div>

        <!-- Información del libro -->
        <div class="book-info">
            <label for="book-title">Título del libro:</label>
            <input type="text" id="book-title" placeholder="Introduce el nombre del libro">
        </div>

        <!-- Calificación del libro -->
        <div class="rating">
            <label for="rating">Calificación:</label>
            <div class="stars">
                <span class="star" data-value="1">&#9733;</span>
                <span class="star" data-value="2">&#9733;</span>
                <span class="star" data-value="3">&#9733;</span>
                <span class="star" data-value="4">&#9733;</span>
                <span class="star" data-value="5">&#9733;</span>
            </div>
        </div>

        <!-- Reseña del libro -->
        <div class="review">
            <label for="review-text">Escribe una reseña:</label>
            <textarea id="review-text" rows="5" placeholder="Escribe tu reseña aquí"></textarea>
        </div>

        <!-- Botón de envío -->
        <button id="submit-btn">Enviar Calificación y Reseña</button>
    </div>
</div>
</body>
</html>
